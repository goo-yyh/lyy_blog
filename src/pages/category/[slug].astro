---
import { getCollection } from 'astro:content';
import { CATEGORIES, type CategorySlug } from '../../content.config';
import BaseLayout from '../../layouts/BaseLayout.astro';
import GroupedPostList from '../../components/GroupedPostList.astro';

export function getStaticPaths() {
  return Object.keys(CATEGORIES).map(slug => ({ params: { slug } }));
}

const { slug } = Astro.params as { slug: CategorySlug };
const categoryName = CATEGORIES[slug];

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter(p => p.data.category === categoryName)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---
<BaseLayout title={categoryName}>

  <div class="mb-12 pb-10 border-b-2 border-charcoal">
    <p class="font-mono text-xs text-muted uppercase tracking-[0.35em] mb-3">
      {posts.length} Articles
    </p>
    <h1 class="font-mono text-3xl uppercase tracking-tight text-charcoal">
      {categoryName}
    </h1>
  </div>

  {posts.length === 0 ? (
    <p class="font-mono text-sm text-muted uppercase tracking-widest">暂无文章</p>
  ) : (
    <GroupedPostList posts={posts} showCategory={false} />
  )}

</BaseLayout>
