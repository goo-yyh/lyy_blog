---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await getCollection('blog');
const sorted = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const base = import.meta.env.BASE_URL;
---
<BaseLayout title="我的博客">

  <!-- Page hero -->
  <div class="mb-16 border-b-2 border-charcoal pb-10">
    <p class="font-mono text-xs text-muted uppercase tracking-[0.35em] mb-4">
      {sorted.length} Articles
    </p>
    <h1 class="font-mono text-[clamp(3.5rem,12vw,8rem)] uppercase leading-none tracking-tighter text-charcoal select-none">
      文章
    </h1>
  </div>

  <!-- Post list -->
  <ul class="space-y-3">
    {sorted.map((post, i) => {
      const formattedDate = post.data.date.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      });
      return (
        <li>
          <a
            href={`${base}posts/${post.id}/`}
            class="group flex items-start gap-5 p-6
                   bg-paper border-2 border-charcoal
                   shadow-[4px_4px_0px_#383838]
                   hover:bg-accent hover:shadow-[6px_6px_0px_#383838]
                   hover:-translate-x-0.5 hover:-translate-y-0.5
                   transition-all duration-100
                   block"
          >
            <!-- Index number -->
            <span class="font-mono text-xs text-muted group-hover:text-charcoal/40 pt-0.5 w-6 shrink-0 select-none">
              {String(i + 1).padStart(2, '0')}
            </span>

            <!-- Content -->
            <div class="flex-1 min-w-0">
              <h2 class="font-mono text-sm uppercase tracking-wide text-charcoal leading-snug">
                {post.data.title}
              </h2>
              {post.data.description && (
                <p class="mt-1.5 text-sm text-muted group-hover:text-charcoal/60 leading-relaxed">
                  {post.data.description}
                </p>
              )}
            </div>

            <!-- Date -->
            <time
              datetime={post.data.date.toISOString()}
              class="font-mono text-xs text-muted whitespace-nowrap group-hover:text-charcoal/60 shrink-0 pt-0.5"
            >
              {formattedDate}
            </time>
          </a>
        </li>
      );
    })}
  </ul>

</BaseLayout>
