---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const posts = await getCollection('blog');
const sorted = posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const base = import.meta.env.BASE_URL;
---
<BaseLayout title="所有文章">

  <!-- Header -->
  <div class="mb-12 pb-10 border-b-2 border-charcoal">
    <p class="font-mono text-xs text-muted uppercase tracking-[0.35em] mb-3">
      {sorted.length} Articles
    </p>
    <h1 class="font-mono text-3xl uppercase tracking-tight text-charcoal">
      所有文章
    </h1>
  </div>

  <!-- Post list -->
  <ul class="space-y-3">
    {sorted.map((post, i) => {
      const formattedDate = post.data.date.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      });
      return (
        <li>
          <a
            href={`${base}posts/${post.id}/`}
            class="group flex items-start gap-5 p-6
                   bg-paper border-2 border-charcoal
                   shadow-[4px_4px_0px_#383838]
                   hover:bg-accent hover:shadow-[6px_6px_0px_#383838]
                   hover:-translate-x-0.5 hover:-translate-y-0.5
                   transition-all duration-100 block"
          >
            <span class="font-mono text-xs text-muted group-hover:text-charcoal/40 pt-0.5 w-6 shrink-0 select-none">
              {String(i + 1).padStart(2, '0')}
            </span>
            <div class="flex-1 min-w-0">
              {post.data.category && (
                <span class="font-mono text-[10px] uppercase tracking-widest text-muted group-hover:text-charcoal/50 block mb-1">
                  {post.data.category}
                </span>
              )}
              <h2 class="font-mono text-sm uppercase tracking-wide text-charcoal leading-snug">
                {post.data.title}
              </h2>
              {post.data.description && (
                <p class="mt-1.5 text-sm text-muted group-hover:text-charcoal/60 leading-relaxed">
                  {post.data.description}
                </p>
              )}
            </div>
            <time
              datetime={post.data.date.toISOString()}
              class="font-mono text-xs text-muted whitespace-nowrap group-hover:text-charcoal/60 shrink-0 pt-0.5"
            >
              {formattedDate}
            </time>
          </a>
        </li>
      );
    })}
  </ul>

</BaseLayout>
